---
id: what-is-workflow-versioning
title: What is Workflow Versioning?
sidebar_label: Workflow Versioning
description: This page describes what workflow versioning is and how it works.
tags:
  - term
  - versioning
---

Workflow Versioning manages changes or upgrades to your Workflowâ€™s logic. Because Workflows can run for weeks, months, or years you may want to make changes to your Workflow code over time.

As outlined in the [Workflow Implementation Constraints](#deterministic-constraints) section, Workflow code has to be deterministic by taking the same code path when replaying History Events.
Any Workflow code change that affects the order in which commands are generated breaks this assumption.

For example, if you have a Workflow that calls an Activity and then returns its value, and you change the Workflow to sleep before calling the Activity, the Workflow will return a different value when replaying the History Events, causing a non-deterministic error.

Versioning your Workflows is a solution to update your Workflow code without causing non-determisnitc behaviors in long-running Workflows.

### When to use Workflow Versioning

Use Workflow Versioning when you need to make changes to your Workflow code but still have Workflow instances running older versions of the code.
For example, if you have a long-running Workflow, and you need to make a change to the Workflow code, you can use Workflow Versioning to make the change to your code without affecting the running Workflow instance.

You do not need to Version your Workflows if you're, for example, adding a Signal Handler for a Signal type that has never been sent before, because the Signal Handler does not affect the path of the code execution.

If you don't need to preserve your currently running Workflow Executions, you can terminate all the currently running Workflow Executions and suspend new ones from being created while you deploy the new version of your Workflow code. Then, resume Workflow creation.

### How to use Workflow Versioning

The Workflow Versioning feature enables the creation of logical branching inside a Workflow Definition based on a developer specified version identifier.
This feature is useful for Workflow Definition logic needs to be updated, but there are running Workflow Executions that currently depends on it.
It is important to note that a practical way to handle different versions of Workflow Definitions, without using the versioning API, is to run the different versions on separate Task Queues.

- [How to version Workflow Definitions in Go](/go/versioning)
- [How to version Workflow Definitions in Java](/java/versioning)
- [How to version Workflow Definitions in TypeScript](/typescript/versioning)

#### Patch Workflow Definition

Patching a Workflow Definition is a three-step process:

1. [Integrate the new code in a patch and run it concurrently with the old code](#1-patch-in-new-code).
2. [Deprecate and remove the old code](#2-deprecate-patch).
3. [Once you're confident that all old instances have finished executing, entirely remove the deprecated patch](#3-solely-deploy-new-code).

:::note Do I need to patch?

You may need to patch if:

- You want to change the remaining logic of a Workflow while it is still running
- If your new logic can result in a different execution path

:::

The following section describes these steps in details.

##### 1. Patch in new code

This step involves integrating a marker into the Workflow history. This marker is critical as, during replay, when a Worker encounters a history with that marker, it will fail the Workflow task when running code that does not emit the same patch marker. Thus, it is safe to deploy the updated version in a "feature flag" format alongside the original version.

##### 2. Deprecate patch

Once you're confident that all instances started with the original code have completed, you can deprecate the patch. Deprecated patches act as a bridge between the updated version and the final version. They work in a similar way to regular patches by recording a marker in the Workflow history. However, this marker does not fail replay when Workflow code does not emit it.

If you're deploying the third version and there are still live Workers running the second version code, and these Workers encounter Workflow histories generated by the third version, they will safely utilize the patched branch.

##### 3. Solely deploy new code

The final version is safe to deploy once all instances of the second version or earlier are complete. This is due to the assertion that patches ensure safety between code versions. At this stage, there is no need to integrate or deprecate patches, as your Workflow is now running the final version of the code.

#### Version Workflow Type

You can version a Workflow Type by changing its name. For example, if you have a Workflow Type called `Workflow1`, you can create a new version of it by creating a new Workflow Type called `Workflow2`.

1. Copy `Workflow1`'s code to a `Workflow2` function and change what you need.
2. Register `Workflow2` in your Workers alongside `Workflow1`.
3. Cut over your Clients to only call `Workflow2` from now on.
4. Remove `Workflow1` code when none of them are running anymore.

#### Replays

When making code changes to a Workflow, it is important to avoid introducing non-deterministic behavior.

One way to prevent this error from occurring is to use the [Workflow Replayer](/workflows#replays) to replay existing Workflow Histories against your new code before deploying it to production.

:::important

While the Workflow Replay helps to avoid non-deterministic code, it doesn't guarantee that your code is deterministic.

:::

##### How to use the Workflow Replayer

To use the Workflow Replayer, you need to provide the following:

- The Workflow Replayer to register the Workflow that you want to replay
- A Workflow History to execute, either:
  - Loaded directly from the Client
  - Loaded from the JSON History file

Consult the [SDK specific documentation](/dev-guide/) for information on using the Workflow Replayer programmatically.

If you chose to load the Event History from a JSON file on disk, you can do so programmatically or from one of the following methods:

##### The Temporal CLI

Use the Temporal CLI to download the Workflow History file from the CLI:

```command
temporal workflow show --workflow-id <workflow_id> --output json > <output_file>
```

##### The Temporal Web UI

Navigate through the Temporal Web UI to download the Workflow History file:

1. Navigate to the Workflow Execution you want to download the History from.
2. In the **Recent Events** section, select **Download**.

Once you have the Workflow JSON History file, you can use the Workflow Replayer to replay the Workflow History, in the SDK of your choice.

##### Replay existing Workflow Histories in CI

Use the Workflow Replayer in your existing Continuous Integration (CI) pipeline to ensure that new versions of your Workflow are compatible with every change pushed to your version control management. By replaying existing Workflow Histories, you can validate that they do not break determinism and prevent failures from occurring in production.

To use the Replayer in your CI pipeline, consider the following steps:

1. Fetch a representative sample of Workflow Histories to replay against your new Workflow version. For example, you could fetch the 100 most recent Histories for your Workflow and replay all them.
2. Run the Replayer against each of the fetched Histories to ensure that the new Workflow version is compatible with each of them.

   - If the Replayer finds any incompatible changes, the CI pipeline should fail to prevent these changes from going into production. In this case, you should identify and fix the issues before retrying the CI pipeline.
   - If the Replayer doesn't find any incompatible changes, the CI pipeline should succeed. You can then proceed with confidence that your changes are compatible with your existing Workflow Histories.

For more information on testing Workflows, see the SDK specific documentation on [Test frameworks](/dev-guide/).

##### What happens if I don't use the Workflow Replayer?

If you don't use the Workflow Replayer and your Workflow contains non-deterministic code, you may see a non-determinism error.

This may mean that your new code is not compatible with existing Workflow Histories.

If you are making incompatible code changes to your Workflows and have to deal with Workflow versioning, see [Workflow Versioning Strategies](https://community.temporal.io/t/workflow-versioning-strategies/6911) for more information.

#### Workflow Signature changes

Workflows on a versioned Task Queue shouldn't change their signature.
If you need to change the signature of a Workflow, use a different Workflow Type or an entirely new Task Queue.

### Unversioned Workflows

If a Workflow starts off unversioned, then it remains unversioned until the completion of the Workflow.
